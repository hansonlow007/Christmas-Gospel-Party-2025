<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ„ Christmas Gospel Party 2025 Invitation ğŸ‰</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <div class="invite-wrapper">
      
      <div class="snow-layer"></div>

      <header class="header">
        <button class="music-btn" aria-label="Play background music" data-playing="false">
          <span class="icon">â™ª</span>
        </button>
        <img
          src="images/logo.png"
          alt="Christmas Gospel Party 2025 Logo"
          class="logo"
        />

        <audio id="bg-music" src="music.mp3" loop preload="auto"></audio>
      </header>

      <main class="content-sections">
        
        <section class="info-card glass-effect">
          <h2 class="card-heading script-font">Date</h2>
          <p class="card-text">December 25, 2025</p>
          <p class="card-subtext">THURSDAY</p>
        </section>

        <section class="info-card glass-effect">
          <h2 class="card-heading script-font">Time</h2>
          <p class="card-text">1:00 PM - 5:00 PM</p>
        </section>

        <section class="info-card glass-effect">
          <h2 class="card-heading script-font">Venue</h2>
          <p class="card-text">Edgewood Residence Â· Setapak</p>
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3983.625652079799!2d101.72068069999999!3d3.1926856999999993!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31cc3981e09d5e53%3A0xb36b76f0ff6cdf37!2sEdgeWood%20Residences%20%40%20SkySanctuary!5e0!3m2!1sen!2smy!4v1764751472452!5m2!1sen!2smy" width="300" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

        <section class="message-section">
          <p class="blessing-line script-font">
            May your heart be filled with joy and hope this Christmas season.
          </p>
        </section>

        <section class="agenda-section glass-effect">
          <h2 class="card-heading script-font">Event Agenda</h2>
          <div class="agenda-items">
            <div class="agenda-item">
              <span class="agenda-time">1:00 PM</span>
              <span class="agenda-event">Arrival & Welcome</span>
            </div>
            <div class="agenda-item">
              <span class="agenda-time">1:30 PM</span>
              <span class="agenda-event">Christmas Carols & Sharing</span>
            </div>
            <div class="agenda-item">
              <span class="agenda-time">2:00 PM</span>
              <span class="agenda-event">Christmas Feast</span>
            </div>
            <div class="agenda-item">
              <span class="agenda-time">3:00 PM</span>
              <span class="agenda-event">Gospel Movie Screening</span>
            </div>
            <div class="agenda-item">
              <span class="agenda-time">4:50 PM</span>
              <span class="agenda-event">Group Photos</span>
            </div>
              <div class="agenda-item">
            <span class="agenda-time">5:00 PM</span>
            <span class="agenda-event">Event Ends</span>
          </div>
          </div>
        </section>

        <section class="movie-section glass-effect">
            <h2 class="card-heading">Movie of the Day</h2>
        
            <div class="movie-info">
                <p class="movie-title">
                    <span class="script-font" style="color: #c0392b;">The King of Kings</span>
                </p>
                <p class="movie-description">
                    The King of Kings is an animated film that tells the story of Jesus Christ through a framing narrative of Charles Dickens narrating the tale to his son. The movie depicts key events in Jesus's life, from birth to crucifixion and resurrection, as the son's imagination visualizes them.
                </p> <img src="images/poster.jpg"> 
            </div>
        
            <div class="trailer-container">
                <iframe class="trailer-embed" 
        src="https://www.youtube.com/embed/HDhet3EVRac?si=iKWS4B8CUuBqOKI_&autoplay=1&mute=1" 
        title="YouTube video player" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
        referrerpolicy="strict-origin-when-cross-origin" 
        allowfullscreen></iframe>
            </div>
        </section>

        <section class="dress-code-section glass-effect"> 
            <h2 class="card-heading script-font">Dress Code</h2>
            <ul class="dress-list">
              </ul>
            <li class="dress-item">
              <span class="dress-dot red"></span>
              <span class="dress-label">Red</span>
            </li>
            <li class="dress-item">
              <span class="dress-dot green"></span>
              <span class="dress-label">Green</span>
            </li>
            <li class="dress-item">
              <span class="dress-dot white"></span>
              <span class="dress-label">White</span>
            </li>
            <li class="dress-item">
              <span class="dress-dot free"></span>
              <span class="dress-label">Free Style / Festive</span>
            </li>
          </ul>
        </section>

        <section class="rsvp-section">
            <p class="rsvp-message"><b>Please RSVP by December 15th so we can prepare accordingly.</b></p>
            
            <a 
              href="https://wa.me/60173436134?text=Hello%2C%20I%20would%20like%20to%20RSVP%20for%20the%20party." 
              target="_blank" 
              class="rsvp-button"
              rel="noopener noreferrer"
            >
              Click to RSVP
            </a>
          </section>

          <section class="raffle-section glass-effect">
            <h2 class="card-heading script-font">Gift Draw</h2>
            <p class="card-subtext">Scan the unique code to draw your secret gift number (1-20).</p>
            
            <div class="qr-code-scan-area">
                <div id="reader" style </div>
                <p class="scan-message" id="scan-message">Tap button below to activate camera.</p>
              </div>
              
              <button class="draw-button" id="activate-camera-button">ACTIVATE CAMERA & START SCAN</button>
            
              <div class="draw-result-container">
                <p class="result-label">Your Gift Number:</p>
                <div class="result-number" id="raffle-result">--</div>
                <p class="remaining-count" id="remaining-count">Remaining: 20 numbers</p>
              </div>
            </section>
          
            </section>

      </main>



      

      <footer class="footer">
        With love, Jeremiah & Hanson Â· Christmas Gospel Party 2025
      </footer>
    </div>

    <script>
      (function () {
        const musicButton = document.querySelector(".music-btn");
        const backgroundMusic = document.getElementById("bg-music");
        const snowLayer = document.querySelector(".snow-layer");
        const logoElement = document.querySelector(".logo");
        const inviteWrapper = document.querySelector(".invite-wrapper");

       // --- 1. é›ªèŠ±/åœ£è¯ Emoji æ‰è½æ•ˆæœ ---
// --- 1. Snowfall Effect (Restored Snowflakes) ---
if (snowLayer) {
  const count = 60; // è°ƒæ•´é›ªèŠ±æ•°é‡

  const createSnowflake = () => {
    // å…ƒç´ å˜å› divï¼Œä¾é  CSS æ¸²æŸ“æˆç™½è‰²åœ†ç‚¹
    const flake = document.createElement("div");
    flake.className = "snowflake"; 

    // éšæœºåŒ–å±æ€§
    const left = Math.random() * 100; // 0% to 100% å®½åº¦
    const duration = 10 + Math.random() * 10; // 10s to 20s
    const delay = Math.random() * 15; // 0s to 15s å»¶è¿Ÿ
    const size = 5 + Math.random() * 10; // 5px to 15px å¤§å°
    const drift = (Math.random() - 0.5) * 100; // å·¦å³æ¼‚ç§»

    flake.style.left = `${left}%`;
    flake.style.animationDuration = `${duration}s`;
    flake.style.animationDelay = `${delay}s`;
    // ç”¨ width/height ä»£æ›¿ fontSize æ¥æ§åˆ¶å¤§å°
    flake.style.width = `${size}px`; 
    flake.style.height = `${size}px`;
    flake.style.setProperty("--x-offset", `${drift}px`);

    snowLayer.appendChild(flake);

    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
    flake.addEventListener("animationend", () => flake.remove());
  };

  // åˆå§‹åˆ›å»ºé›ªèŠ±
  for (let i = 0; i < count; i++) {
    createSnowflake();
  }

  // æŒç»­æ·»åŠ æ–°çš„é›ªèŠ±
  setInterval(createSnowflake, 1500); // æ¯ 1.5 ç§’æ·»åŠ ä¸€ä¸ªæ–°é›ªèŠ±

  snowLayer.style.opacity = "1"; 
}

        // --- 2. Music Player Control ---
        if (musicButton && backgroundMusic) {
          let isPlaying = false; 

          const updateMusicButton = () => {
            if (isPlaying) {
              musicButton.classList.add("playing");
              musicButton.setAttribute("aria-label", "Pause background music");
              musicButton.querySelector(".icon").textContent = "â…¡"; 
            } else {
              musicButton.classList.remove("playing");
              musicButton.setAttribute("aria-label", "Play background music");
              musicButton.querySelector(".icon").textContent = "â™ª"; 
            }
          };

          musicButton.addEventListener("click", async () => {
            try {
              if (isPlaying) {
                backgroundMusic.pause();
              } else {
                await backgroundMusic.play();
              }
              isPlaying = !isPlaying;
              updateMusicButton();
            } catch (error) {
              console.error("Music play/pause failed:", error);
              alert("The browser may block autoplay. Please try clicking the button again.");
            }
          });

          updateMusicButton();

          document.addEventListener('DOMContentLoaded', () => {
            if (backgroundMusic.paused && !isPlaying) {
              backgroundMusic.muted = true;
              backgroundMusic.play().then(() => {
                backgroundMusic.pause(); 
                backgroundMusic.muted = false; 
              }).catch(e => {
                console.log("Silent autoplay failed, waiting for user interaction.", e);
              });
            }
          });
        }

        // --- 3. Logo Interaction Effect ---
        if (logoElement && inviteWrapper) {
          logoElement.style.cursor = "pointer";

          const createPopEmoji = () => {
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            const pop = document.createElement("div");
            pop.className = "logo-pop-emoji";
            pop.textContent = emoji;

            const rect = logoElement.getBoundingClientRect();
            const wrapperRect = inviteWrapper.getBoundingClientRect();

            const x = rect.left + rect.width / 2 - wrapperRect.left;
            const y = rect.top + rect.height / 2 - wrapperRect.top;

            pop.style.left = `${x}px`;
            pop.style.top = `${y}px`;

            inviteWrapper.appendChild(pop);

            pop.addEventListener("animationend", () => pop.remove());
          };

          logoElement.addEventListener("click", () => {
            logoElement.classList.remove("logo-pop");
            void logoElement.offsetWidth; 
            logoElement.classList.add("logo-pop");

            createPopEmoji();
            setTimeout(createPopEmoji, 100);
            setTimeout(createPopEmoji, 200);
          });
        }
      })();

      // --- 4. ç¤¼ç‰©æŠ½å–é€»è¾‘ (Raffle Draw) ---
// --- 4. ç¤¼ç‰©æŠ½å–é€»è¾‘ (Raffle Draw) ---
(function() {
    const DRAWN_NUMBERS_KEY = 'raffle_drawn_numbers';
    const MY_NUMBER_KEY = 'raffle_my_number';
    const minNumber = 1;
    const maxNumber = 20;

    const resultDisplay = document.getElementById('raffle-result');
    const remainingCountDisplay = document.getElementById('remaining-count');
    const scanMessage = document.getElementById('scan-message');
    
    // æ–°å¢ï¼šæ¿€æ´»æŒ‰é’®çš„å¼•ç”¨
    const activateCameraButton = document.getElementById('activate-camera-button');

    let html5QrCode = null;

    // --- è¾…åŠ©å‡½æ•° (ä¿æŒä¸å˜) ---
    const getDrawnNumbers = () => {
        const storedNumbers = localStorage.getItem(DRAWN_NUMBERS_KEY);
        return storedNumbers ? JSON.parse(storedNumbers) : [];
    };
    const getRemainingNumbers = () => {
        const drawnList = getDrawnNumbers();
        const fullList = Array.from({ length: maxNumber - minNumber + 1 }, (_, i) => i + minNumber);
        return fullList.filter(num => !drawnList.includes(num));
    };

    // --- UI æ›´æ–°å‡½æ•° ---
    const updateUI = (myNumber = localStorage.getItem(MY_NUMBER_KEY)) => {
        const remainingList = getRemainingNumbers();
        remainingCountDisplay.textContent = `Remaining: ${remainingList.length} numbers`;
        
        // 1. å¦‚æœç”¨æˆ·å·²ç»æŠ½å–è¿‡äº†
        if (myNumber) {
            resultDisplay.textContent = myNumber;
            scanMessage.textContent = "âœ… Your number is locked. Enjoy the party!";
            remainingCountDisplay.textContent += ' (You already drew)';
            if(activateCameraButton) activateCameraButton.style.display = 'none';
            return;
        } 
        
        // 2. å¦‚æœå·ç å…¨éƒ¨æŠ½å®Œ
        if (remainingList.length === 0) {
            resultDisplay.textContent = 'END';
            scanMessage.textContent = "All numbers have been drawn!";
            if(activateCameraButton) activateCameraButton.style.display = 'none';
            return;
        }

        // 3. å‡†å¤‡å¯åŠ¨
        resultDisplay.textContent = '--';
        scanMessage.textContent = "Tap button below to activate camera.";
        if(activateCameraButton) activateCameraButton.style.display = 'block';
    };

    // --- æ ¸å¿ƒæŠ½å¥–é€»è¾‘ (ä¿æŒä¸å˜) ---
    const drawNumber = (onCompleteCallback) => {
        // ... (ä¿æŒ drawNumber å‡½æ•°çš„å†…éƒ¨é€»è¾‘ä¸å˜) ...
        const remainingList = getRemainingNumbers();

        if (remainingList.length === 0) {
            updateUI();
            onCompleteCallback();
            return;
        }

        resultDisplay.classList.add('drawing');
        resultDisplay.textContent = '...';

        setTimeout(() => {
            const randomIndex = Math.floor(Math.random() * remainingList.length);
            const drawnNumber = remainingList[randomIndex];
            
            const drawnList = getDrawnNumbers();
            drawnList.push(drawnNumber);
            localStorage.setItem(DRAWN_NUMBERS_KEY, JSON.stringify(drawnList));
            localStorage.setItem(MY_NUMBER_KEY, drawnNumber);
            
            resultDisplay.textContent = drawnNumber;
            resultDisplay.classList.remove('drawing');
            
            updateUI(drawnNumber); 
            alert(`Congratulations! Your gift number is ${drawnNumber}!`);
            onCompleteCallback(); 
            
        }, 1500);
    };


    // --- æ‘„åƒå¤´å’Œæ‰«æé€»è¾‘ ---

    const onScanSuccess = (decodedText, decodedResult) => {
        if (localStorage.getItem(MY_NUMBER_KEY)) {
            // å¦‚æœå·²ç»æŠ½è¿‡ï¼Œåœæ­¢æ‰«æå™¨ä½†ä¸è§¦å‘æŠ½å¥–
            if(html5QrCode) html5QrCode.stop().then(() => { scanMessage.textContent = "Camera stopped. Already drew."; });
            return;
        }
        
        if (decodedText) {
            if(html5QrCode) html5QrCode.stop().then(() => {
                scanMessage.textContent = "Code scanned! Drawing your number...";
                // æŠ½å¥–å®Œæˆåï¼ŒUI ä¼šè‡ªåŠ¨æ›´æ–°
                drawNumber(() => {}); 
            }).catch(err => {
                 console.error("Failed to stop scanning.", err);
            });
        }
    };

    // å¯åŠ¨æ‰«æå™¨å‡½æ•°
    const startScanner = () => {
        if (localStorage.getItem(MY_NUMBER_KEY) || getRemainingNumbers().length === 0) {
            return;
        }

        html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start(
            { facingMode: "environment" }, 
            { fps: 10, qrbox: { width: 200, height: 200 } },
            onScanSuccess,
            (errorMessage) => {
                 // æ‰«æå¤±è´¥æ—¶çš„å¤„ç†
            }
        ).then(() => {
             scanMessage.textContent = "Camera active. Hold the QR code steady.";
             // å¯åŠ¨æˆåŠŸåéšè—å¯åŠ¨æŒ‰é’®
             if(activateCameraButton) activateCameraButton.style.display = 'none'; 
        }).catch((err) => {
            scanMessage.textContent = `Error: Cannot start camera. Check permissions. (${err.message.substring(0, 50)}...)`;
             if(activateCameraButton) activateCameraButton.style.display = 'block'; 
        });
    };

    // --- ç›‘å¬äº‹ä»¶ ---
    document.addEventListener('DOMContentLoaded', () => {
        // é¦–æ¬¡åŠ è½½æ—¶ï¼Œåªåˆå§‹åŒ–UIçŠ¶æ€ï¼Œä¸è‡ªåŠ¨å¯åŠ¨
        updateUI(); 
        
        // åªæœ‰å½“ç”¨æˆ·æœªæŠ½å–ä¸”è¿˜æœ‰å·ç æ—¶ï¼Œæ‰ç»‘å®šå¯åŠ¨äº‹ä»¶
        if (activateCameraButton && !localStorage.getItem(MY_NUMBER_KEY) && getRemainingNumbers().length > 0) {
            activateCameraButton.addEventListener('click', startScanner);
        } else if (activateCameraButton) {
            // å¦‚æœå·²æŠ½å–æˆ–å·ç æŠ½å®Œï¼Œç›´æ¥éšè—æŒ‰é’®
             activateCameraButton.style.display = 'none';
        }
    });
})();
    </script>
  </body>
</html>